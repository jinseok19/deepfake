# EXP-002: ν”„λ μ„ μ μ¦κ°€ (30β†’40)

## π“‹ μ‹¤ν— μ •λ³΄

| ν•­λ© | λ‚΄μ© |
|------|------|
| **μ‹¤ν— λ²νΈ** | EXP-002 |
| **μ‹¤ν— λ‚ μ§** | 2025-10-29 |
| **λ² μ΄μ¤ μ½”λ“** | λ² μ΄μ¤λΌμΈ (EXP-000) |
| **μ£Όμ” λ³€κ²½** | NUM_FRAMES: 30 β†’ 40 |
| **F1 Score** | **0.5506** |
| **λ² μ΄μ¤λΌμΈ λ€λΉ„** | **+0.0017 (+0.31%)** |
| **μ¶”λ΅  μ‹κ°„** | (μ„λ²„ μ¶”λ΅ ) |

---

## π― μ‹¤ν— λ©μ 

**λ² μ΄μ¤λΌμΈμ—μ„ ν”„λ μ„ μλ§ μ¦κ°€μ‹μΌ μ„±λ¥ ν–¥μƒ κ²€μ¦**

- EXP-001μ—μ„ μ—¬λ¬ λ³€κ²½μ‚¬ν•­μ΄ μ¤νλ ¤ μ„±λ¥ ν•λ½ μ΄λ
- κ°€μ¥ μ•μ „ν•κ³  ν¨κ³Όμ μΈ κ°μ„  λ°©λ²•λ¶€ν„° λ‹¨λ… ν…μ¤νΈ
- λ” λ§μ€ ν”„λ μ„ = λ” λ§μ€ μ •λ³΄ = λ” μ •ν™•ν• νλ‹¨

---

## π”§ λ¨λΈ μ•„ν‚¤ν…μ²

### μ‚¬μ© λ¨λΈ
- **λ°±λ³Έ**: `google/vit-base-patch16-224-in21k`
- **λ¨λΈ**: `deep-fake-detector-v2-model` (λ² μ΄μ¤λΌμΈκ³Ό λ™μΌ)
- **μ…λ ¥ ν¬κΈ°**: 224x224
- **μ¶λ ¥**: Binary Classification (Real:0, Fake:1)

### λ¨λΈ νλΌλ―Έν„°
```python
model = ViTForImageClassification.from_pretrained(model_path).to("cuda")
processor = ViTImageProcessor.from_pretrained(model_path)
model.eval()
```

---

## π”„ νμ΄ν”„λΌμΈ μƒμ„Έ

### 1οΈβƒ£ μ „μ²λ¦¬ (Pre-processing)

#### μ–Όκµ΄ κ²€μ¶ λ° ν¬λ΅­
```python
def detect_and_crop_face_optimized(image, target_size=(224, 224)):
    - dlib face detector μ‚¬μ©
    - margin = 1.3 (λ² μ΄μ¤λΌμΈκ³Ό λ™μΌ)
    - μ–Όκµ΄ μ—†μΌλ©΄ None λ°ν™
```

#### ν”„λ μ„ μƒν”λ§ β­ **λ³€κ²½μ **
```python
# λ² μ΄μ¤λΌμΈ
num_frames_to_extract = 30

# EXP-002
num_frames_to_extract = 40  # +33% μ¦κ°€!
```

**λ³€κ²½ κ·Όκ±°**:
- λ” λ§μ€ ν”„λ μ„ = λ” ν’λ¶€ν• μ‹κ°„μ  μ •λ³΄
- λ”¥νμ΄ν¬ ν”μ μ„ λ†“μΉ  ν™•λ¥  κ°μ†
- λ€λ¶€λ¶„μ λ”¥νμ΄ν¬ λ€νμ—μ„ ν¨κ³Ό κ²€μ¦λ¨

#### μ΄λ―Έμ§€/λΉ„λ””μ¤ μ²λ¦¬
```python
- μ΄λ―Έμ§€: λ‹¨μΌ μ–Όκµ΄ κ²€μ¶
- λΉ„λ””μ¤: κ· λ“± μƒν”λ§ (linspace)
  * 30ν”„λ μ„μ§λ¦¬ β†’ 40ν”„λ μ„ μƒν”λ§
  * μ‹μ‘λ¶€ν„° λκΉμ§€ κ· λ“± λ¶„ν¬
```

#### μ „μ²λ¦¬ νλΌλ―Έν„°
| νλΌλ―Έν„° | κ°’ | λ² μ΄μ¤λΌμΈ λ€λΉ„ |
|---------|-----|----------------|
| `NUM_FRAMES` | 40 | 30 β†’ 40 β¬†οΈ |
| `margin` | 1.3 | λ™μΌ |
| `target_size` | 224Γ—224 | λ™μΌ |
| `resize_for_detection` | 640 | λ™μΌ |
| `μ–Όκµ΄ λ―Έκ²€μ¶ μ²λ¦¬` | λ μ΄λΈ” 0 | λ™μΌ |

**μμƒ ν¨κ³Ό**: +2~4% (λ” λ§μ€ μ •λ³΄)

---

### 2οΈβƒ£ λ¨λΈλ§ (Modeling)

#### μ¶”λ΅  λ΅μ§
```python
# λ°°μΉ λ‹¨μ„ GPU μ¶”λ΅  (λ² μ΄μ¤λΌμΈκ³Ό λ™μΌ)
inputs = processor(images=face_images, return_tensors="pt").to("cuda")
with torch.no_grad():
    outputs = model(**inputs)
    logits = outputs.logits
    probs = F.softmax(logits, dim=1)
```

#### λ¨λΈ νλΌλ―Έν„°
| νλΌλ―Έν„° | κ°’ | λ² μ΄μ¤λΌμΈ λ€λΉ„ |
|---------|-----|----------------|
| λ¨λΈ | ViT-Base | λ™μΌ |
| Batch Processing | μ‚¬μ© | λ™μΌ |
| GPU | CUDA 11.8 | λ™μΌ |

**λ³€κ²½ μ‚¬ν•­**: μ—†μ (λ² μ΄μ¤λΌμΈκ³Ό λ™μΌ)

**μμƒ ν¨κ³Ό**: 0% (λ³€κ²½ μ—†μ)

---

### 3οΈβƒ£ ν›„μ²λ¦¬ (Post-processing)

#### μμΈ΅ μ§‘κ³„ (Aggregation)
```python
# Mean only (λ² μ΄μ¤λΌμΈκ³Ό λ™μΌ)
avg_probs = probs.mean(dim=0)
predicted_class = torch.argmax(avg_probs).item()
```

#### μ–Όκµ΄ λ―Έκ²€μ¶ μ²λ¦¬
```python
if not face_images:
    results_to_write[filename] = 0  # Realλ΅ λ¶„λ¥ (λ² μ΄μ¤λΌμΈκ³Ό λ™μΌ)
```

#### ν›„μ²λ¦¬ νλΌλ―Έν„°
| νλΌλ―Έν„° | κ°’ | λ² μ΄μ¤λΌμΈ λ€λΉ„ |
|---------|-----|----------------|
| μ§‘κ³„ λ°©λ²• | Mean only | λ™μΌ |
| ν”„λ μ„ ν•„ν„°λ§ | μ—†μ | λ™μΌ |
| μ–Όκµ΄ λ―Έκ²€μ¶ | λ μ΄λΈ” 0 | λ™μΌ |

**λ³€κ²½ μ‚¬ν•­**: μ—†μ (λ² μ΄μ¤λΌμΈκ³Ό λ™μΌ)

**μμƒ ν¨κ³Ό**: 0% (λ³€κ²½ μ—†μ)

---

## π”„ λ² μ΄μ¤λΌμΈ λ€λΉ„ λ³€κ²½ μ‚¬ν•­

### λ³€κ²½ μ”μ•½

| λ‹¨κ³„ | λ³€κ²½ ν•­λ© | λ² μ΄μ¤λΌμΈ | EXP-002 | μν–¥ |
|------|----------|-----------|---------|------|
| μ „μ²λ¦¬ | NUM_FRAMES | 30 | 40 | β¬†οΈ |
| λ¨λΈλ§ | - | - | - | - |
| ν›„μ²λ¦¬ | - | - | - | - |

### λ³€κ²½μ  μƒμ„Έ λ¶„μ„

#### β… μ μΌν• λ³€κ²½: ν”„λ μ„ μ μ¦κ°€
```python
num_frames_to_extract = 40  # 30 β†’ 40
```

**μ¥μ **:
- β… λ” λ§μ€ μ‹κ°„μ  μ •λ³΄ ν™•λ³΄
- β… λ”¥νμ΄ν¬ ν”μ  ν¬μ°© ν™•λ¥  μ¦κ°€
- β… κ²€μ¦λ κ°μ„  λ°©λ²•
- β… λ¦¬μ¤ν¬ λ‚®μ

**λ‹¨μ **:
- β οΈ μ¶”λ΅  μ‹κ°„ μ¦κ°€ (70λ¶„ β†’ 85~90λ¶„)
- β οΈ GPU λ©”λ¨λ¦¬ μ‚¬μ©λ‰ μ†ν­ μ¦κ°€

#### β… μ μ§€λ κ²ƒλ“¤ (EXP-001 μ‹¤ν¨ κµν›)
```python
β“ μ–Όκµ΄ μ—†μΌλ©΄ λ μ΄λΈ” 0 (μ¤‘μ•™ ν¬λ΅­ NO!)
β“ Mean only (Mean+Max NO!)
β“ λ¨λ“  ν”„λ μ„ μ‚¬μ© (ν•„ν„°λ§ NO!)
β“ margin = 1.3 (μ μ§€)
```

---

## π“ κ²°κ³Ό

### μ •λ‰μ  κ²°κ³Ό

| λ©”νΈλ¦­ | λ² μ΄μ¤λΌμΈ | EXP-002 | λ³€ν™” |
|--------|-----------|---------|------|
| **Macro F1** | 0.5489 | **0.5506** | **+0.0017 (+0.31%)** |
| **μ •ν™•λ„ μ¶”μ •** | - | - | - |
| **μ¶”λ΅  μ‹κ°„** | ~70λ¶„ | (μ„λ²„ μ¶”λ΅ ) | - |

### μ •μ„±μ  λ¶„μ„

**μ‹¤μ  κ²°κ³Ό**: β οΈ **μμƒλ³΄λ‹¤ ν›¨μ”¬ λ‚®μ€ ν–¥μƒ**

**μμƒ vs μ‹¤μ **:
- μμƒ: F1 0.57~0.59 (+4~8%)
- μ‹¤μ : F1 0.5506 (+0.31%)
- μ°¨μ΄: **μμƒλ³΄λ‹¤ -3.7~7.7% λ‚®μ**

**ν‰κ°€**:
1. β οΈ **ν”„λ μ„ μ μ¦κ°€ ν¨κ³Ό λ―Έλ―Έ**: ν†µκ³„μ  μ¤μ°¨ μμ¤€
2. β οΈ **30ν”„λ μ„μΌλ΅ μ¶©λ¶„**: μ¶”κ°€ ν”„λ μ„μ΄ μ¤‘λ³µ μ •λ³΄
3. β οΈ **μ¶”λ΅  μ‹κ°„λ§ μ¦κ°€**: μ„±λ¥ ν–¥μƒ μ—†μ΄ λΉ„ν¨μ¨μ 

---

## π” μƒμ„Έ λ¶„μ„

### μ„±λ¥ μν–¥ μ”μΈ λ¶„μ„

#### 1. ν”„λ μ„ μ μ¦κ°€μ ν¨κ³Ό

**κ°€μ„¤**:
```
λ” λ§μ€ ν”„λ μ„ β†’ λ” λ§μ€ μ •λ³΄ β†’ λ” μ •ν™•ν• νλ‹¨
```

**λ©”μ»¤λ‹μ¦**:
- 30ν”„λ μ„: λΉ„λ””μ¤λ¥Ό 30κ° κµ¬κ°„μΌλ΅ μƒν”λ§
- 40ν”„λ μ„: λΉ„λ””μ¤λ¥Ό 40κ° κµ¬κ°„μΌλ΅ μƒν”λ§ (+33%)
- λ” μ΄μ΄ν• μ‹κ°„ μƒν”λ§ β†’ λ”¥νμ΄ν¬ ν”μ  λ†“μΉ  ν™•λ¥  β¬‡οΈ

**μμƒ μ‹λ‚λ¦¬μ¤**:
```
λΉ„λ””μ¤ κΈΈμ΄κ°€ 300ν”„λ μ„μ΄λΌλ©΄:
- λ² μ΄μ¤λΌμΈ: 10ν”„λ μ„λ§λ‹¤ 1κ° μƒν”λ§
- EXP-002: 7.5ν”„λ μ„λ§λ‹¤ 1κ° μƒν”λ§
β†’ λ” μ„Έλ°€ν• λ¶„μ„ κ°€λ¥
```

#### 2. λ¦¬μ¤ν¬ λ¶„μ„

**λ‚®μ€ λ¦¬μ¤ν¬**:
- β… λ‹¨μΌ λ³€κ²½ (λ…ν™•ν• μΈκ³Όκ΄€κ³„)
- β… λ‹¤λ¥Έ λ΅μ§ μ „λ¶€ μ μ§€
- β… κ²€μ¦λ κ°μ„  λ°©λ²•

**μ μ¬μ  λ¬Έμ **:
- β οΈ μ¶”λ΅  μ‹κ°„ μ¦κ°€ (3μ‹κ°„ μ ν• μ•μ—λ” μ—¬μ  μμ)
- β οΈ GPU OOM κ°€λ¥μ„± λ‚®μ (λ°°μΉ λ‹¨μ„ μ²λ¦¬)

---

## π’΅ κ²°λ΅  λ° λ‹¤μ λ‹¨κ³„

### μ‹¤ν— μ”μ•½

**ν•µμ‹¬ μ „λµ**: κ²€μ¦λ κ°μ„  λ°©λ²•λ¶€ν„° λ‹¨λ… ν…μ¤νΈ

**λ³€κ²½ μ‚¬ν•­**: NUM_FRAMES 30 β†’ 40λ§ λ³€κ²½

**μ‹¤μ  ν¨κ³Ό**: +0.31% (F1 0.5506) β οΈ **μμƒλ³΄λ‹¤ ν›¨μ”¬ λ‚®μ**

**κµν›**: 
- ν”„λ μ„ μ μ¦κ°€λ§μΌλ΅λ” μ„±λ¥ ν–¥μƒ ν•κ³„
- 30ν”„λ μ„μΌλ΅ μ΄λ―Έ μ¶©λ¶„ν• μ •λ³΄ ν™•λ³΄
- λ¨λΈ μμ²΄ κ°μ„  ν•„μ” (νμΈνλ‹, TTA λ“±)

---

### λ‹¤μ μ‹¤ν— κ³„ν

#### β… μ„ νƒλ μ‹λ‚λ¦¬μ¤: λ―Έλ―Έν• ν–¥μƒ (F1 0.5506, +0.31%)

β†’ **EXP-003 Option A**: ν”„λ μ„ 40 + TTA (ν„μ¬ μ½”λ“)
```python
- NUM_FRAMES = 40 μ μ§€
- TTA μ¶”κ°€ (μΆμ° λ°μ „)
- ν”„λ μ„ 40 + TTA μ΅°ν•© ν¨κ³Ό κ²€μ¦
- μμƒ: F1 0.56~0.58 (+1~2%)

μ¥μ : μ΄λ―Έ μ¤€λΉ„λ¨, TTA ν¨κ³Ό λ‹¨λ… κ²€μ¦ κ°€λ¥
λ‹¨μ : μ¶”λ΅  μ‹κ°„ μ¦κ°€ (140~160λ¶„)
```

β†’ **EXP-003 Option B**: ν”„λ μ„ 30 + TTA (μ½”λ“ μμ •)
```python
- NUM_FRAMES = 30 λ³µκµ¬
- TTAλ§ μ μ©
- ν”„λ μ„ μ ν¨κ³Ό λ°°μ , TTAλ§ μ§‘μ¤‘
- μμƒ: F1 0.56~0.57 (+1~2%)

μ¥μ : μ¶”λ΅  μ‹κ°„ μ μ•½ (70~90λ¶„), TTA μμ ν¨κ³Ό
λ‹¨μ : μ½”λ“ μμ • ν•„μ”
```

β†’ **EXP-004**: λ°”λ΅ νμΈνλ‹
```python
- λ‹¨μ κΈ°λ²• ν•κ³„ ν™•μΈ
- λ¨λΈ μμ²΄ κ°μ„  ν•„μ”
- FaceForensics++ νμΈνλ‹
- μμƒ: F1 0.60~0.65 (+5~10%)

μ¥μ : κ·Όλ³Έμ  μ„±λ¥ ν–¥μƒ
λ‹¨μ : μ‹κ°„ μ†μ” (3~5μΌ)
```

---

### μ¥κΈ° μ „λµ

1. **λ‹¨κ³„λ³„ κ°μ„ **
   - ν• λ²μ— ν•λ‚μ”©
   - ν¨κ³Ό λ…ν™•ν μΈ΅μ •
   - μ„±κ³µν• κ²ƒλ§ λ„μ 

2. **κ²€μ¦λ κΈ°λ²• μ°μ„ **
   - β… ν”„λ μ„ μ μ¦κ°€ (EXP-002)
   - β… TTA (EXP-003)
   - β… μ•™μƒλΈ” (λ‚μ¤‘μ—)

3. **μ„ν—ν• μ‹λ„λ” λ‚μ¤‘μ—**
   - β οΈ μ¤‘μ•™ ν¬λ΅­ (μ‹¤ν¨ ν™•μΈ)
   - β οΈ Mean+Max (μ‹¤ν¨ ν™•μΈ)
   - β οΈ ν”„λ μ„ ν•„ν„°λ§ (μ‹¤ν¨ ν™•μΈ)

---

## π“ λ©”λ¨

### μ‹¤ν— μ¤‘ κ΄€μ°° μ‚¬ν•­
- (κ²°κ³Ό λ‚μ¨ ν›„ μ—…λ°μ΄νΈ)

### μ¶”κ°€ μ‹λ„ν•  λ°©λ²•
- TTA (Test Time Augmentation)
- ν”„λ μ„ μƒν”λ§ μ „λµ λ³€κ²½ (μ‹μ‘/μ¤‘κ°„/λ μ§‘μ¤‘)
- Margin μ΅°μ • (1.3 β†’ 1.4)
- μ•™μƒλΈ” (μ—¬λ¬ μ²΄ν¬ν¬μΈνΈ)

### μ°Έκ³  μ‚¬ν•­
- μ¶”λ΅  μ‹κ°„ μ ν•: 3μ‹κ°„
- ν•λ£¨ μ μ¶ μ ν•: 3ν
- μµμ† μ μ¶ κ°„κ²©: 30λ¶„

