# 📊 딥페이크 탐지 모델 - 전체 실험 요약

> **대회**: 딥페이크 범죄 대응을 위한 AI 탐지 모델 경진대회  
> **기간**: 2024.10.23 ~ 2024.11.20  
> **평가지표**: Macro F1-score (Fake=양성)  
> **Competition Key**: `c346c572-9253-418e-8a95-52cf0afa1611` (CUDA 11.8)

---

## 🏆 최고 성적

| 항목 | 값 |
|------|-----|
| **최고 F1 Score** | **0.5600** |
| **실험 번호** | EXP-003-Fixed |
| **베이스라인 대비** | **+2.01%** |
| **순위** | - |
| **최신 제출** | EXP-005 v2 (대실패) |

---

## 📈 실험 진행 현황

| 번호 | 일시 | 모델 | F1 Score | 베이스라인 대비 | 순위 | 상태 | 상세 |
|------|------|------|----------|----------------|------|------|------|
| **BASELINE** | - | ViT-base | 0.5489 | - | - | 🎯 참조 | - |
| EXP-001 | 10.24 20:20 | ViT-base | 0.5354 | **-2.46%** ❌ | 7위 | ❌ 실패 | [📄](EXP-001.md) |
| EXP-002 | 10.29 16:36 | ViT-base | 0.5506 | **+0.31%** ⚠️ | - | ⚠️ 미미 | [📄](EXP-002.md) |
| EXP-003 | 10.29 20:45 | ViT-base+TTA | **에러** | - | - | ❌ 실패 | 메모리 OOM |
| **EXP-003-Fixed** | 10.29 22:04 | ViT-base+TTA | **0.5600** | **+2.01%** ✅ | - | 🏆 최고 | [📄](EXP-003-Fixed.md) |
| EXP-004 | 10.30 02:15 | ViT+FF++ | **0.2773** | **-49.5%** ❌ | - | ❌ 대실패 | [📄](EXP-004.md) 모델 경로 오류 |
| EXP-005 (v1) | 10.30 05:03 | ViT+FF++반전 | **에러** | - | - | ❌ 실패 | 코드 오류 |
| **EXP-005 (v2)** | 10.30 13:45 | ViT+FF++반전 | **0.4082** | **-27.1%** ❌ | - | ❌ 대실패 | [📄](EXP-005.md) 라벨 반전 역효과 |

---

## 📊 성능 추이 그래프

```
F1 Score
0.60 |                                      🎯 목표 (0.60)
     |
0.58 |
     |
0.56 |                        ▲ EXP-003-Fixed (0.5600) 🏆 +2.01%
     |                    ▪ EXP-002 (0.5506) +0.31%
0.54 |  ▬ BASELINE (0.5489)
     |              
0.53 |              ■ EXP-001 (0.5354) ❌ -2.46%
     |
0.52 |
     |
0.50 |
     +------------------------------------------
        BASELINE    EXP-001    EXP-002    EXP-003-Fixed
```

---

## 🔬 주요 발견 사항

### ❌ 실패한 기법 (단계별)

#### 1️⃣ 전처리 (Pre-processing)
- **중앙 크롭** (얼굴 미검출 시) - 기여도 **-1~2%** ❌
  - 문제: 얼굴 없는 이미지를 억지로 예측 → 노이즈
  - 교훈: **얼굴 없음 = Real** 휴리스틱이 데이터에 맞음

#### 2️⃣ 모델링 (Modeling)
- 변경 없음

#### 3️⃣ 후처리 (Post-processing)
- **Mean + Max 조합** (0.6/0.4) - 기여도 **-0.5~1%** ❌
  - 문제: Max가 노이즈 증폭
  - 교훈: **Mean only**가 더 안정적
- **프레임 필터링** (검출 성공만) - 기여도 **-0.5~1%** ❌
  - 문제: 정보 손실
  - 교훈: 모든 프레임 사용이 나음

### ✅ 성공한 기법

#### 전처리
- [✅] 프레임 수 증가 (30 → 40) - **EXP-002** (+0.31%)

#### 후처리
- [✅] TTA (좌우 반전) - **EXP-003-Fixed** (+1.69%) ⭐

### ❌ 시도하지 않은 기법

#### 전처리
- [ ] 프레임 수 추가 증가 (40 → 50+)
- [ ] TTA (회전, 스케일)
- [ ] 동적 프레임 샘플링
- [ ] margin 최적화

#### 모델링
- [ ] 모델 파인튜닝 ⭐ (단일 모델만 허용)
- [ ] 다른 아키텍처 시도 (단일 모델)
- [❌] ~~모델 앙상블~~ **규칙 위반!**

#### 후처리
- [ ] Mean/Max 비율 Grid Search
- [ ] Median 사용
- [ ] 확률 임계값 조정

### 🤔 확인이 필요한 것
- **전처리**: margin 최적값 (1.3? 1.4? 1.5?)
- **전처리**: 프레임 수와 성능 관계
- **후처리**: Mean/Max 비율 최적값

---

## 🎯 최신 성과 (EXP-003-Fixed)

### ✅ 완료: TTA 메모리 최적화 + CUDA 12.6 🏆
- **결과**: F1 **0.5600** (+2.01%)
- **목표 달성**: Test Time Augmentation으로 성능 향상 성공
- **전략**: EXP-002 기반 + TTA (좌우 반전) + 메모리 최적화

#### 주요 성과

**✅ TTA 효과 검증**
- EXP-002 대비: **+1.69%**
- 프레임 증가보다 **5배 효과적**
- 좌우 반전 앙상블이 정확도 향상

**✅ 메모리 최적화 성공**
```python
# 순차 처리로 OOM 해결
# 1. 원본 40개 추론 (~6GB)
# 2. 반전 40개 추론 (~6GB)
# 3. 앙상블
avg_probs = (probs_orig + probs_flip) / 2.0
```

**✅ CUDA 12.6 안정성**
- PyTorch 2.7.1 최신 최적화
- 메모리: 12GB → 6GB (50% 절감)
- 실행 안정성 확인

**성능 분해**:
- 베이스라인 → EXP-002 (프레임 40): +0.31%
- EXP-002 → EXP-003-Fixed (TTA): +1.69%
- **총 향상**: +2.01% ✅

### 향후 실험 아이디어 (단계별)

#### 전처리
1. **프레임 수 최적화**: 30, 35, 40, 45 비교
2. **TTA 적용**: 좌우 반전, 회전, 스케일
3. **동적 샘플링**: 장면 전환 감지

#### 모델링 ⚠️ (단일 모델만 허용)
1. **파인튜닝**: FaceForensics++, Celeb-DF로 학습
2. **다른 아키텍처**: ViT 변형, ConvNeXt 시도
3. [❌] ~~앙상블~~ **규칙 위반!**

#### 후처리
1. **가중치 Grid Search**: Mean/Max 비율 최적화
2. **Median 추가**: Mean, Max, Median 조합
3. **임계값 조정**: 확률 기반 필터링

---

## 📋 파라미터 변화 추이

### 전처리 파라미터
| 파라미터 | BASELINE | EXP-001 | EXP-002 (계획) |
|----------|----------|---------|----------------|
| NUM_FRAMES | 30 | 30 | **40** |
| margin | 1.3 | 1.3 | **1.4** |
| 얼굴 미검출 처리 | 레이블 0 | 중앙 크롭 | 중앙 크롭 |
| 데이터 증강 | 없음 | 없음 | 없음 |

### 모델링 파라미터
| 파라미터 | BASELINE | EXP-001 | EXP-002 (계획) |
|----------|----------|---------|----------------|
| 모델 | ViT-base | ViT-base | ViT-base |
| BATCH_SIZE | 전체 | 16 | 16 |

### 후처리 파라미터
| 파라미터 | BASELINE | EXP-001 | EXP-002 (계획) |
|----------|----------|---------|----------------|
| MEAN_WEIGHT | 1.0 | 0.6 | **0.7** |
| MAX_WEIGHT | 0.0 | 0.4 | **0.3** |
| 프레임 필터링 | 없음 | 검출 성공만 | 검출 성공만 |

---

## 💡 학습한 교훈

1. **베이스라인 정확히 파악하기**
   - 처음에 0.50으로 착각 → 실제 0.5489
   - 정확한 베이스라인 파악이 실험 분석의 시작!

2. **"개선"이 항상 좋은 것은 아니다**
   - EXP-001: 모든 "개선" 시도가 역효과 (-2.46%)
   - **검증 없는 가설은 위험**하다

3. **단순한 전략이 더 효과적일 수 있다**
   - 얼굴 없음 = Real (단순하지만 효과적)
   - Mean only (Max보다 안정적)
   - 모든 프레임 사용 (필터링보다 나음)

4. **체계적인 실험 관리의 중요성**
   - 단계별 기여도 추정
   - 실패로부터 배우기
   - 베이스라인으로 돌아갈 용기

---

## 📞 참고 자료

- 대회 페이지: https://aifactory.space/task/9197
- 리더보드: https://aifactory.space/task/9197/leaderboard
- Q&A: https://aifactory.space/task/9197/qna

---

**마지막 업데이트**: 2025.10.30  
**총 실험 횟수**: 7회  
**남은 일일 제출**: 0회 (오늘 제출 완료)  
**현재 최고**: 0.5600 (EXP-003-Fixed) 🏆  
**최신 제출**: EXP-005 v2 (0.4082, 대실패)  
**다음 계획**: 데이터 수집 + 파인튜닝 (EXP-006~007)

