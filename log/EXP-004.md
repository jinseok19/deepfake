# EXP-004: FaceForensics++ νμΈνλ‹

## π“‹ μ‹¤ν— κ°μ”
- **μ‹¤ν— λ²νΈ**: EXP-004
- **μ‹¤ν— μΌμ‹**: 2025-10-29
- **λ¨λΈλ…**: EXP-004-FF++-Finetuned
- **μ „λµ**: FaceForensics++ λ°μ΄ν„°λ΅ ViT λ¨λΈ νμΈνλ‹
- **λ² μ΄μ¤λΌμΈ μ μ**: 0.5489
- **ν™κ²½**: Google Colab (L4 GPU)

---

## π― μ‹¤ν— λ©ν‘

### μ£Όμ” λ©ν‘
1. **κ³µκ° λ°μ΄ν„°μ…‹μΌλ΅ λ¨λΈ νμΈνλ‹**
2. **λ”¥νμ΄ν¬ νƒμ§€ μ„±λ¥ λ€ν­ ν–¥μƒ**
3. **λ‹¨μΌ λ¨λΈλ΅ μµκ³  μ„±λ¥ λ‹¬μ„±** (μ•™μƒλΈ” κΈμ§€ κ·μΉ™ μ¤€μ)

### κ°€μ„¤
- FaceForensics++ λ°μ΄ν„°λ΅ νμΈνλ‹ν•λ©΄ λ² μ΄μ¤λΌμΈ λ€λΉ„ 10~20% μ„±λ¥ ν–¥μƒ κΈ°λ€

---

## π“ λ°μ΄ν„°μ…‹

### FaceForensics++ (c40)
- **Original**: 100κ° λΉ„λ””μ¤
- **DeepFakes**: 100κ° λΉ„λ””μ¤
- **μ΄ ν”„λ μ„**: μ–Όκµ΄ μ¶”μ¶ ν›„ μμ² κ°

### μ „μ²λ¦¬
- **ν”„λ μ„ μƒν”λ§**: λΉ„λ””μ¤λ‹Ή 30 ν”„λ μ„
- **μ–Όκµ΄ νƒμ§€**: Dlib frontal face detector
- **ν¬λ΅­**: Bounding box + 40% margin
- **λ¦¬μ‚¬μ΄μ¦**: 224Γ—224 (ViT μ…λ ¥)

### Train/Val λ¶„ν• 
- **Train**: 80%
- **Val**: 20%
- **Stratified split**: ν΄λμ¤ κ· ν• μ μ§€

---

## π§  λ¨λΈ μ•„ν‚¤ν…μ²

### λ² μ΄μ¤ λ¨λΈ
```python
# Option 1: λ² μ΄μ¤λΌμΈ λ¨λΈ (Drive μ—…λ΅λ“ μ‹)
MODEL_PATH = "/content/drive/MyDrive/deepfake_models/deep-fake-detector-v2-model"

# Option 2: μ›λ³Έ ViT λ¨λΈ (μλ™ fallback)
MODEL_PATH = "google/vit-base-patch16-224-in21k"
```

### λ¨λΈ κµ¬μ΅°
- **μ•„ν‚¤ν…μ²**: ViT-Base-Patch16-224
- **νλΌλ―Έν„°**: ~86M
- **Pre-trained**: ImageNet-21k
- **Output**: Binary classification (Real: 0, Fake: 1)

---

## π”§ ν•™μµ μ„¤μ •

### ν•μ΄νΌνλΌλ―Έν„°
```python
num_train_epochs = 3
per_device_train_batch_size = 16
per_device_eval_batch_size = 32
learning_rate = 2e-5          # λ‚®μ€ LR (νμΈνλ‹)
weight_decay = 0.01
warmup_ratio = 0.1
fp16 = True                   # Mixed precision
```

### μµμ ν™” μ„¤μ •
- **Optimizer**: AdamW (Hugging Face Trainer κΈ°λ³Έ)
- **Learning Rate Scheduler**: Linear with warmup
- **Warmup**: μ „μ²΄ stepμ 10%
- **Mixed Precision**: FP16 (μ†λ„/λ©”λ¨λ¦¬ μµμ ν™”)

### Evaluation μ „λµ
- **Strategy**: Steps (200 stepλ§λ‹¤ ν‰κ°€)
- **Metric**: Macro F1-score
- **Best Model**: F1 κΈ°μ¤€ μµκ³  λ¨λΈ μλ™ μ €μ¥
- **Early Stopping**: μ—†μ (3 epochλ§ ν•™μµ)

---

## π“ ν•™μµ κ²°κ³Ό

### Training Progress
| Step | Training Loss | Validation Loss | Val F1 Macro | Val F1 Fake |
|------|--------------|----------------|--------------|-------------|
| 200  | 0.1988       | 0.1426         | **0.9566**   | 0.9569      |
| 400  | 0.0722       | 0.0485         | **0.9867**   | 0.9867      |
| 600  | 0.0310       | 0.0339         | **0.9925**   | 0.9925      |
| 800  | 0.0122       | 0.0313         | **0.9933**   | 0.9933      |

### μµμΆ… μ„±λ¥ (Validation)
```
Validation F1 Macro:  0.9933 (99.33%)
Validation F1 Fake:   0.9933 (99.33%)
Validation Loss:      0.0313
```

### ν•™μµ νΉμ§•
β… **μ•μ •μ μΈ ν•™μµ**
- Training loss μ§€μ† κ°μ†: 0.1988 β†’ 0.0122
- Validation loss μ•μ •μ : 0.1426 β†’ 0.0313
- **κ³Όμ ν•© μ—†μ!** (train/val loss ν•¨κ» κ°μ†)

β… **λΉ λ¥Έ μλ ΄**
- Step 200μ—μ„ μ΄λ―Έ 95.66% F1
- Step 400μ—μ„ 98.67% F1
- Step 800μ—μ„ 99.33% F1 (κ±°μ μ™„λ²½)

---

## π― μ„±λ¥ λ¶„μ„

### FaceForensics++ Validation μ„±λ¥
```
F1 Macro:  0.9933
F1 Fake:   0.9933
Precision: ~0.99
Recall:    ~0.99
```

**ν•΄μ„:**
- FF++ λ°μ΄ν„°μ—μ„ κ±°μ μ™„λ²½ν• μ„±λ¥
- Real/Fake κµ¬λ¶„ λ§¤μ° μ •ν™•
- ν΄λμ¤ λ¶κ· ν• μ—†μ (Macro F1 = Binary F1)

### λ² μ΄μ¤λΌμΈ λ€λΉ„ κ°μ„ 
| ν•­λ© | λ² μ΄μ¤λΌμΈ | EXP-004 (Val) | κ°μ„  |
|------|-----------|---------------|------|
| F1 Score | 0.5489 | 0.9933 | **+81.0%** |

**ν•μ§€λ§!** β οΈ
- Val μ„±λ¥μ€ FF++ λ°μ΄ν„° κΈ°μ¤€
- λ€ν ν…μ¤νΈμ…‹μ€ λ‹¤λ¥Έ λ¶„ν¬μΌ κ°€λ¥μ„±
- μ‹¤μ  μ„±λ¥μ€ λ” λ‚®μ„ μ μμ

---

## π’­ μμƒ μ‹¤μ  μ„±λ¥

### λ‚™κ΄€μ  μ‹λ‚λ¦¬μ¤ (λ€ν λ°μ΄ν„° β‰ FF++)
```
μμƒ F1: 0.85~0.95
κ°μ„ : +55~73%
```

### ν„μ‹¤μ  μ‹λ‚λ¦¬μ¤ (λ€ν λ°μ΄ν„° β‰  FF++)
```
μμƒ F1: 0.65~0.75
κ°μ„ : +18~37%
```

### λ³΄μμ  μ‹λ‚λ¦¬μ¤ (λ€ν λ°μ΄ν„° << FF++)
```
μμƒ F1: 0.58~0.65
κ°μ„ : +6~18%
```

### μμƒ μ΄μ 
**κΈμ •μ  μ”μΈ:**
- FF++λ” λ‹¤μ–‘ν• κΈ°λ²• ν¬ν•¨ (DeepFakes, Face2Face λ“±)
- κ³ ν’μ§ ν•™μµμΌλ΅ μΌλ°ν™” λ¥λ ¥ ν–¥μƒ
- κ³Όμ ν•© μ—†μ

**λ¶€μ •μ  μ”μΈ:**
- λ€ν λ°μ΄ν„°λ” μµμ‹  κΈ°λ²• ν¬ν•¨ κ°€λ¥
- λ‹¤λ¥Έ ν™”μ§/μ••μ¶•λ¥ 
- λ‹¤λ¥Έ μΈμΆ…/μ—°λ Ή λ¶„ν¬

**ν„μ‹¤μ  μμƒ: F1 0.65~0.70 (+19~28%)** π―

---

## π”¬ μ „μ²λ¦¬ (Pre-processing)

### λ™μΌν• μ „μ²λ¦¬ μ μ§€
- **ν”„λ μ„ μ**: 40 (EXP-002/003κ³Ό λ™μΌ)
- **μ–Όκµ΄ νƒμ§€**: Dlib
- **ν¬λ΅­ λ°©μ‹**: Bounding box + margin
- **λ¦¬μ‚¬μ΄μ¦**: 224Γ—224

**λ³€ν™” μ—†μ** - λ¨λΈλ§ κµμ²΄

---

## π§  λ¨λΈλ§ (Modeling) β­ ν•µμ‹¬ λ³€κ²½

### Before (λ² μ΄μ¤λΌμΈ)
```python
model = load("deep-fake-detector-v2-model")
# μ›μ €μκ°€ νμΈνλ‹ν• λ¨λΈ
```

### After (EXP-004)
```python
model = load("google/vit-base-patch16-224-in21k")
model = finetune(model, FaceForensics_data, epochs=3)
# FF++ λ°μ΄ν„°λ΅ μ§μ ‘ νμΈνλ‹
```

### νμΈνλ‹ μ „λµ
- **Transfer Learning**: ImageNet pre-trained weights μ‚¬μ©
- **Low Learning Rate**: 2e-5 (κΈ°μ΅΄ μ§€μ‹ μ μ§€)
- **Short Training**: 3 epochs (κ³Όμ ν•© λ°©μ§€)
- **Data Augmentation**: κΈ°λ³Έ (Processor μλ™)

---

## π“ ν›„μ²λ¦¬ (Post-processing)

### λ™μΌν• μ§‘κ³„ λ°©μ‹
```python
# ν”„λ μ„λ³„ μμΈ΅ ν‰κ· 
probs = model(frames)  # (40, 2)
avg_prob = probs.mean(dim=0)  # (2,)
pred = argmax(avg_prob)
```

**λ³€ν™” μ—†μ** - EXP-002/003κ³Ό λ™μΌ

---

## π― κ°μ„  ν¬μΈνΈ μ”μ•½

### 1. μ „μ²λ¦¬ (Pre-processing)
- **λ³€ν™” μ—†μ**: EXP-002μ™€ λ™μΌ

### 2. λ¨λΈλ§ (Modeling) β­β­β­
- **νμΈνλ‹**: FaceForensics++ 100+100 λΉ„λ””μ¤
- **Learning Rate**: 2e-5 (μµμ )
- **Epochs**: 3 (κ³Όμ ν•© λ°©μ§€)
- **Val F1**: 0.9933 (FF++ κΈ°μ¤€)

### 3. ν›„μ²λ¦¬ (Post-processing)
- **λ³€ν™” μ—†μ**: Mean aggregation

---

## π’» ν™κ²½ λ° μ†μ” μ‹κ°„

### Google Colab ν™κ²½
- **GPU**: L4 (24GB VRAM)
- **CPU**: 8 cores
- **RAM**: 48GB

### μ†μ” μ‹κ°„
- **μ–Όκµ΄ μ¶”μ¶ μ „μ²λ¦¬**: ~1-2μ‹κ°„ (λΉ„λ””μ¤ 200κ°)
- **νμΈνλ‹**: ~2-3μ‹κ°„ (3 epochs)
- **μ΄ μ†μ”**: ~3-5μ‹κ°„

### λ¦¬μ†μ¤ μ‚¬μ©
- **GPU λ©”λ¨λ¦¬**: ~10-12GB (λ°°μΉ 16)
- **λ””μ¤ν¬**: ~5GB (μ „μ²λ¦¬ λ°μ΄ν„°)
- **ν¨μ¨**: λ§¤μ° μ•μ •μ  (OOM μ—†μ)

---

## π“¦ μ μ¶ μ¤€λΉ„

### 1. λ¨λΈ μ €μ¥ μ„μΉ
```
Colab: /content/deepfake_finetune/output/final_model/
Drive: /content/drive/MyDrive/deepfake_models/faceforensics_finetuned/
ZIP:   /content/drive/MyDrive/deepfake_models/faceforensics_model.zip
```

### 2. λ΅μ»¬ λ°°μΉ
```bash
# λ‹¤μ΄λ΅λ“ ν›„
μ••μ¶• ν•΄μ  β†’ submit/models/faceforensics_finetuned/
```

### 3. task.ipynb μμ •
```python
# Cell 15 - λ¨λΈ κ²½λ΅ λ³€κ²½
model_path = "./model/faceforensics_finetuned"

# Cell 19 - μ μ¶ μ •λ³΄
aif.submit(
    model_name="EXP-004-FF++-Finetuned",
    key="492f7ace-67d6-4636-8448-25def840e236"  # CUDA 12.6
)
```

### 4. μ μ¶ νƒ€μ΄λ°
- **EXP-003-Fixed κ²°κ³Ό ν™•μΈ ν›„** μ μ¶
- λ‚¨μ€ μ μ¶ νμ: 0~1ν
- μ‹ μ¤‘ν•κ² κ²°μ •

---

## π”„ λΉ„κµ: λ² μ΄μ¤λΌμΈ vs EXP-004

### λ² μ΄μ¤λΌμΈ λ¨λΈ
```
μ›μ €μ νμΈνλ‹ λ°μ΄ν„°: 140,002κ° μ΄λ―Έμ§€
ν•™μµ ν™κ²½: μ• μ μ—†μ
Val F1: 0.92 (μ›μ €μ λ³΄κ³ )
λ€ν F1: 0.5489
```

### EXP-004 λ¨λΈ
```
νμΈνλ‹ λ°μ΄ν„°: FF++ 200κ° λΉ„λ””μ¤ β†’ μμ² κ° ν”„λ μ„
ν•™μµ ν™κ²½: Colab L4 GPU, 3 epochs
Val F1: 0.9933 (FF++ κΈ°μ¤€)
λ€ν F1: λ€κΈ° μ¤‘ (μμƒ 0.65~0.70)
```

### μ°¨μ΄μ 
1. **λ°μ΄ν„°**: λ² μ΄μ¤λΌμΈμ€ μ΄λ―Έμ§€, EXP-004λ” FF++ λΉ„λ””μ¤
2. **ν•™μµ λ°©λ²•**: λ² μ΄μ¤λΌμΈμ€ from scratch?, EXP-004λ” transfer learning
3. **μΌλ°ν™”**: λ² μ΄μ¤λΌμΈμ€ λ€ν λ°μ΄ν„°μ™€ λ¶„ν¬ μ°¨μ΄, EXP-004λ„ λ§μ°¬κ°€μ§€

---

## π’΅ μΈμ‚¬μ΄νΈ

### μ„±κ³µ μ”μΈ
1. **μ μ ν• λ°μ΄ν„°**: FF++λ” κ³ ν’μ§ λ”¥νμ΄ν¬ λ°μ΄ν„°
2. **Transfer Learning**: ImageNet μ§€μ‹ ν™μ©
3. **κ³Όμ ν•© λ°©μ§€**: 3 epochs, λ‚®μ€ LR
4. **μ•μ •μ  ν•™μµ**: Mixed precision, μ μ ν• λ°°μΉ ν¬κΈ°

### μ„ν— μ”μ†
1. **Domain Shift**: FF++ β‰  λ€ν λ°μ΄ν„°
2. **λ°μ΄ν„° μ–‘**: 200κ° λΉ„λ””μ¤λ” μ μ„ μ μμ
3. **μµμ‹  κΈ°λ²•**: λ€ν λ°μ΄ν„°κ°€ FF++λ³΄λ‹¤ μµμ‹ μΌ κ°€λ¥μ„±

### κ°μ„  λ°©ν–¥
1. **λ” λ§μ€ λ°μ΄ν„°**: FF++ μ „μ²΄ λ‹¤μ΄λ΅λ“
2. **λ‹¤μ–‘ν• λ°μ΄ν„°μ…‹**: Celeb-DF, DFDC μ¶”κ°€
3. **λ” κΈ΄ ν•™μµ**: 5~10 epochs
4. **Data Augmentation**: λ” κ°•λ ¥ν• μ¦κ°•

---

## π― λ‹¤μ λ‹¨κ³„

### Option A: μ¦‰μ‹ μ μ¶ β­ (μ¶”μ²)
- EXP-003-Fixed κ²°κ³Ό ν™•μΈ ν›„
- Val F1 0.99λ” μ¶©λ¶„ν λ†’μ
- μ‹¤μ  μ„±λ¥ ν™•μΈ ν•„μ”

### Option B: λ” κ°μ„ 
- FF++ μ „μ²΄ λ°μ΄ν„° λ‹¤μ΄λ΅λ“
- Celeb-DF μ¶”κ°€ ν•™μµ
- 10 epochs ν•™μµ

### Option C: λ‹¤λ¥Έ μ ‘κ·Ό
- λ‹¤λ¥Έ μ•„ν‚¤ν…μ² μ‹λ„
- μ•™μƒλΈ”... μ•„λ‹ κ·μΉ™ μ„λ°! β

---

## π“ μμƒ κ²°κ³Ό μ‹λ‚λ¦¬μ¤

### μ‹λ‚λ¦¬μ¤ 1: λ€μ„±κ³µ (F1 > 0.70)
```
β†’ μ¶•ν•! FF++ νμΈνλ‹ ν¨κ³Ό μ…μ¦
β†’ μ¶”κ°€ λ°μ΄ν„°λ΅ λ” κ°μ„ 
β†’ μµμΆ… μμ„ μƒμ„κ¶ κΈ°λ€
```

### μ‹λ‚λ¦¬μ¤ 2: μ„±κ³µ (F1 0.60~0.70)
```
β†’ μλ―Έ μλ” κ°μ„  (+10~28%)
β†’ μ¶”κ°€ νμΈνλ‹ κ³ λ ¤
β†’ TTA + νμΈνλ‹ μ΅°ν•©
```

### μ‹λ‚λ¦¬μ¤ 3: λ³΄ν†µ (F1 0.55~0.60)
```
β†’ μ†ν­ κ°μ„  (+1~10%)
β†’ λ°μ΄ν„° λ¬Έμ  κ°€λ¥μ„±
β†’ λ‹¤λ¥Έ λ°μ΄ν„°μ…‹ μ‹λ„
```

### μ‹λ‚λ¦¬μ¤ 4: μ‹¤ν¨ (F1 < 0.55)
```
β†’ Domain shift μ‹¬κ°
β†’ λ² μ΄μ¤λΌμΈμΌλ΅ λ³µκ·€
β†’ λ‹¤λ¥Έ μ „λµ ν•„μ”
```

---

## π“ ν•µμ‹¬ μ”μ•½

### μ‹¤ν— κ²°κ³Ό
- **Val F1**: 0.9933 (FF++ κΈ°μ¤€)
- **ν•™μµ μ•μ •μ„±**: λ§¤μ° μ•μ •μ 
- **κ³Όμ ν•©**: μ—†μ
- **μ†μ” μ‹κ°„**: 3-5μ‹κ°„

### κΈ°λ€ ν¨κ³Ό
- **μμƒ F1**: 0.65~0.70
- **μμƒ κ°μ„ **: +19~28%
- **λ¶ν™•μ‹¤μ„±**: Domain shift μν–¥

### μ μ¶ μ „λµ
- EXP-003-Fixed κ²°κ³Ό ν™•μΈ ν›„
- μ‹ μ¤‘ν•κ² μ μ¶
- λ‚¨μ€ μ μ¶ νμ κ³ λ ¤

---

## π”– νƒκ·Έ

`#FaceForensics++` `#FineTuning` `#TransferLearning` `#ViT` `#99%Accuracy` `#Colab` `#L4GPU`

---

## π“ κ²°κ³Ό (μ—…λ°μ΄νΈ μμ •)

**μ μ¶ λ€κΈ° μ¤‘...**

- **μ μ¶ μ‹κ°„**: TBD
- **μ‹¤μ  F1**: TBD
- **λ² μ΄μ¤λΌμΈ λ€λΉ„**: TBD
- **μμ„**: TBD

---

**λ§μ§€λ§‰ μ—…λ°μ΄νΈ**: 2025-10-29  
**μƒνƒ**: νμΈνλ‹ μ™„λ£, μ μ¶ μ¤€λΉ„ μ¤‘  
**λ‹¤μ**: EXP-003-Fixed κ²°κ³Ό ν™•μΈ β†’ EXP-004 μ μ¶ κ²°μ •

